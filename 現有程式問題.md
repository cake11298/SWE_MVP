這是一份非常深入的代碼審查（Code Review）。作為你的遊戲架構師，我仔細檢查了你提供的所有腳本、資料結構以及目前的開發狀態。

你的感覺是正確的：**目前專案處於「功能代碼已寫好，但缺乏『膠水』將其組裝成遊戲」的階段。** 這導致了遊戲性低落、UI 沒有反饋、以及物件行為異常。

以下我將針對你提出的四大問題進行具體分析與修復建議，並提供架構優化方案，最後整合出一份全新的 `README.md`。

-----

### 🔍 深度 Code Review 與問題修復

#### 1\. 缺失開始選單 (Main Menu)

**問題根源：**
雖然你有 `MainMenuManager.cs` 和 `GameUIController.cs`，但你的 `SceneSetup.cs` (場景初始化) 是寫死在 `Start()` 裡直接生成玩家和環境，這意味著遊戲一啟動就進入了「遊玩狀態」，跳過了選單階段。

**解決方案：**

  * **場景分離：** Unity 專案應該至少有兩個場景：`MainMenu.unity` 和 `GameScene.unity`。
  * **啟動邏輯：**
    1.  建立一個 `Bootstrap` 場景或在 `MainMenu` 場景掛載 `GameManager` (DontDestroyOnLoad)。
    2.  `MainMenuManager` 應該是 `MainMenu` 場景的進入點。
    3.  點擊「開始遊戲」後，才呼叫 `SceneLoader.LoadScene("GameScene")`。
  * **代碼修正建議：** 不要讓 `SceneSetup` 自動在 Awake/Start 就生成玩家 (`SpawnPlayer`)，應該等待 `GameManager.Instance.StartGame()` 事件觸發後才生成。

#### 2\. 中文亂碼問題 (Text Rendering)

**問題根源：**
Unity 的 **TextMeshPro (TMP)** 預設字型 (`LiberationSans`) **不包含中文字符**。當你嘗試顯示「伏特加」或 NPC 對話時，它找不到對應的字符圖形，就會顯示方框或亂碼。

**解決方案：**

  * **製作字型資產：**
    1.  找一個支援繁體中文的字型檔 (如 `.ttf` 或 `.otf`，例如 Google Noto Sans TC)。
    2.  在 Unity 中使用 `Window > TextMeshPro > Font Asset Creator`。
    3.  Character Set 選擇 "Custom Characters" 並填入你的常用中文字（或選擇 "Chinese Traditional" 範圍）。
    4.  生成並儲存為 `.asset` 檔。
  * **全局替換：** 將所有 UI Prefab 或 `UIBuilder.cs` 中生成的 TMP 元件，其 `fontAsset` 屬性指定為你剛製作的中文 Font Asset。

#### 3\. 酒瓶放回位置錯誤 (Reset to 0,0,0)

**問題根源：**
這是一個經典的「執行順序 (Execution Order)」問題。

  * `InteractableBase.cs` 在 `Awake()` 中記錄 `originalPosition = transform.position;`。
  * `SceneSetup.cs` 或 `BarSceneBuilder.cs` 生成物件時，是先 `Instantiate` (此時觸發 Awake，位置通常是 0,0,0)，**然後**才設定 `transform.position` 到酒架上。
  * 結果：`originalPosition` 永遠被記錄為生成瞬間的 (0,0,0)。

**修復代碼 (`SceneSetup.cs` / `BarSceneBuilder.cs`)：**
在設定完位置後，必須**手動更新**原始位置。

```csharp
// 在生成代碼中修正：
var bottleObj = Instantiate(bottlePrefab, targetPosition, rotation); // 生成並移動
var interactable = bottleObj.GetComponent<InteractableBase>();

// 關鍵修正：手動更新原始位置
if (interactable != null) {
    interactable.SetOriginalPosition(targetPosition); 
    interactable.SetOriginalRotation(rotation);
}
```

#### 4\. 缺乏倒酒 UI 與閉環 (Gameplay Loop Broken)

**問題根源：**
你的 `PourProgressUI.cs` 和 `GameplayHUD.cs` 雖然寫了邏輯，但似乎是**純代碼生成 (Code-Generated UI)**，這在 Unity 中極難維護且容易出錯。

  * `CocktailSystem` 雖然有 `OnPourProgress` 事件，但如果 UI 物件沒有正確訂閱該事件，或者 UI Canvas 的 Layer/Camera 設定錯誤，玩家就甚麼都看不到。
  * **缺乏閉環：** 玩家倒完酒後，`Glass` 物件需要知道自己裝了什麼 (`DrinkInfo`)，這部分邏輯在 `CocktailSystem.cs` 的 `IdentifyCocktail` 雖有，但沒有視覺化反饋告訴玩家「你現在手裡這杯是 Martini」。

**架構建議：**

  * **放棄純代碼 UI (`UIBuilder.cs`)：** 這在 Web 開發 (DOM) 很常見，但在 Unity 是**反模式**。請直接在 Editor 中製作 UI Prefab（包含進度條、文字框）。
  * **事件連接：** 確保 `GameManager` 初始化時，將 `CocktailSystem` 的事件與 `GameplayHUD` 強制綁定。

-----

### 🏗️ 遊戲架構師的開發建議

目前的專案結構是典型的「從 Web 移植到 Unity 的水土不服」。你保留了太多 JS 的習慣（如動態生成 UI、依賴代碼初始化場景），而沒有利用 Unity 的強項（Prefab、Inspector、Scene 編輯）。

**三大核心改善計畫：**

1.  **Prefab 化 (Prefabrication):**

      * 不要用代碼 `GameObject.CreatePrimitive` 來生成酒瓶和杯子。
      * **建立真正的 Prefab：** 在 Editor 中建立一個 Cylinder，掛上 `Bottle` 腳本，設定好材質、Collider、Rigidbody，然後存成 Prefab。
      * **UI Prefab：** 製作一個完整的 HUD Canvas Prefab，包含準心、倒酒條、互動提示。

2.  **場景流程重構 (Scene Flow):**

      * 刪除 `SceneSetup.cs` 中那種「萬能生成」的邏輯。
      * 直接在 Unity Editor 的 Scene 中擺放好地板、吧台、燈光。
      * 只用代碼生成動態物件（酒瓶、NPC）。

3.  **視覺回饋強化 (Feedback Loop):**

      * **倒酒時：** 必須有液體流出的粒子效果（已在 `PouringSystem`，需確認是否運作）。
      * **裝酒後：** 杯子上方應該浮現一個暫時的 UI（World Space Canvas），顯示「Vodka: 50ml」。
      * **送酒時：** 顯示明確的按鍵提示「按 F 遞給 [NPC名字]」。

-----

### 📄 整合版 README.md

我將整合所有文件，並將版本鎖定為 **Unity 2022 LTS**。這份文檔將作為你接下來重構的藍圖。

````markdown
# NCU Molecular Mixology - Bar Simulator (Unity 2022 LTS)

## 專案概述
這是一款從 Three.js 移植至 Unity 的第一人稱沉浸式調酒模擬遊戲。玩家扮演 NCU 分子創意飲品研究社的成員，在虛擬酒吧中學習調酒知識、與社員 NPC 互動，並通過調製正確的飲品來獲得評分。

- **核心引擎**: Unity 2022.3.x LTS (URP Rendering)
- **程式語言**: C#
- **輸入系統**: Unity New Input System

---

## 🚀 快速開始 (Quick Start)

### 1. 環境設置
1.  安裝 **Unity 2022.3 LTS**。
2.  開啟專案，Unity Package Manager 會自動安裝依賴：
    -   `com.unity.inputsystem`
    -   `com.unity.textmeshpro`
    -   `com.unity.render-pipelines.universal`

### 2. 解決中文亂碼 (必要步驟)
由於 TMP 預設不支援中文，請執行以下步驟：
1.  準備一個繁體中文字型檔 (如 `NotoSansTC-Bold.otf`)。
2.  在 Unity 中選擇 `Window > TextMeshPro > Font Asset Creator`。
3.  將字型拖入，Character Set 選擇 **Chinese Traditional**，點擊 **Generate Font Atlas**。
4.  將生成的 `.asset` 檔案指派給 `UIFactory.cs` 或所有 UI Prefab 的 Text 元件。

### 3. 啟動遊戲
1.  打開 `Assets/Scenes/MainMenu.unity` 場景（如果沒有，請參考下文創建）。
2.  點擊 Play。

---

## 🛠️ 開發指南與待修復清單 (Roadmap)

### 🔥 當前優先級修復項目 (High Priority Fixes)

#### 1. 遊戲流程閉環 (Gameplay Loop)
- [ ] **建立 MainMenu 場景**：
    -   創建新場景，移除所有遊戲邏輯，只保留 `MainMenuManager` 和 UI Canvas。
    -   設定按鈕事件連接到 `SceneLoader.LoadGameScene()`。
- [ ] **建立 GameScene 場景**：
    -   預先擺放靜態物件（地板、牆壁、吧台、燈光）以減少 `SceneSetup` 的負擔。
    -   確保 `GameManager` 為場景核心。

#### 2. 互動與物理 (Interaction & Physics)
- [ ] **修正物品重置位置 (0,0,0) Bug**：
    -   在 `SceneSetup.cs` 或生成器中，`Instantiate` 後必須立即呼叫 `bottle.GetComponent<InteractableBase>().SetOriginalPosition(pos)`。
- [ ] **優化拾取手感**：
    -   將 `InteractionSystem` 的 `Drop` 邏輯改為：如果瞄準桌面，則放置在瞄準點；否則放回原位。

#### 3. UI/UX 重構 (UI Refactoring)
- [ ] **廢棄純代碼 UI**：停止使用 `UIBuilder.cs` 逐行生成 UI。
- [ ] **製作 UI Prefabs**：
    -   `HUD_Canvas.prefab`: 包含準心、互動提示文字。
    -   `Pouring_Canvas.prefab`: 包含倒酒進度條。
    -   `Recipe_Book_Canvas.prefab`: 配方書介面。
- [ ] **連接邏輯**：在 `UIManager` 中直接引用這些 Prefab，而不是 `new GameObject`。

---

## 📂 專案結構 (Project Structure)

```text
Assets/
├── Scenes/                 # [新增]
│   ├── MainMenu.unity      # 開始選單
│   └── GameScene.unity     # 主要遊戲場景
├── Prefabs/                # [建議新增] 
│   ├── UI/                 # UI 介面 (HUD, Menus)
│   ├── Props/              # 酒瓶, 杯子, Shaker
│   └── Characters/         # NPC
├── Scripts/
│   ├── Core/               # 核心 (GameManager, SceneLoader)
│   ├── Systems/            # 系統 (Cocktail, Interaction, Physics)
│   ├── UI/                 # UI 邏輯
│   ├── Objects/            # 實體物件邏輯 (Bottle, Glass)
│   ├── Data/               # 資料結構
│   └── Managers/           # 全局管理器
├── Resources/
│   ├── LiquorDatabase      # 酒類數據 SO
│   ├── RecipeDatabase      # 配方數據 SO
│   └── Audio/              # 音效檔
└── Settings/               # URP 設定檔
````

-----

## 🎮 操作說明 (Controls)

| 動作 | 按鍵 | 說明 |
|------|------|------|
| 移動 | W, A, S, D | 第一人稱移動 |
| 視角 | 滑鼠移動 | 轉動視角 |
| 互動/拾取 | E | 拾取物品、與 NPC 對話、操作機器 |
| 放下/歸位 | R | 將手持物品放回原始位置 (酒牆) |
| 智能放置 | Q | 將物品放置在準心指向的桌面 |
| 倒酒/搖酒 | 左鍵 (按住) | 持有酒瓶時倒酒；持有 Shaker 時搖酒 |
| 飲用 | 右鍵 | 持有酒杯時飲用 (測試用) |
| 送酒 | F | 持有酒杯並對準 NPC 時，遞交飲品 |
| 配方書 | M / Tab | 開啟調酒配方表 |
| 暫停 | ESC | 開啟暫停選單 |

-----

## 🍹 調酒機制 (Bartending Mechanics)

1.  **倒酒 (Pouring)**:

      - 拿起酒瓶 (`E`)，對準酒杯。
      - 按住 `左鍵` 倒酒，UI 會顯示容量條。
      - 注意：每種酒有不同的顏色與屬性。

2.  **搖盪 (Shaking)**:

      - 將材料倒入 **Shaker**。
      - 拿起 Shaker，按住 `左鍵` 直到進度條滿（模擬混合）。
      - 混合後的液體顏色會改變。

3.  **評分 (Scoring)**:

      - NPC 會依據：**配方準確度** (幾何距離算法)、**容量**、**酒精濃度** 進行評分 (0-100)。
      - 高分會獲得更多金幣與特殊對話。

-----

## 💾 存檔系統

存檔位於 `Application.persistentDataPath/savegame.json`。
包含：

  - 玩家金錢
  - 解鎖的酒類等級
  - 解鎖的配方

-----

## 📅 版本紀錄

  - **v0.1.0 (Unity Port)**:
      - 核心系統移植完成。
      - 互動系統重寫為 C\# 事件驅動。
      - 已知問題：UI 顯示需優化、中文字型需匯入。

<!-- end list -->

```

### 給你的具體行動步驟 (Action Items)

1.  **切換版本：** 確保 Unity Hub 開啟專案使用的是 2022 LTS 版本。
2.  **建立場景：** 不要依賴自動生成。手動在 Unity Editor 裡把牆壁、地板、吧台擺好，存成 `GameScene`。
3.  **修復物件生成位置：** 打開 `Assets/Scripts/Core/SceneSetup.cs`，找到 `SpawnBottle` 方法，加入 `SetOriginalPosition` 的呼叫。
4.  **解決 UI：** 刪除 `UIBuilder` 生成 Canvas 的代碼。在 Editor 裡創建一個 Canvas，拉好 Image (準心) 和 Text (提示)，做成 Prefab，然後把這個 Prefab 拖給 `UIManager` 的 Inspector 欄位。

這是一個很有潛力的專案，現在只需要把「工程師思維」（純代碼生成）轉變為「Unity 開發思維」（Editor + Prefab + Component），遊戲性就會大幅提升！加油！
```

你的直覺完全正確。這是一個非常典型的\*\*「把 Web 前端/Three.js 的開發邏輯硬套在 Unity 上」\*\*所導致的架構災難。

你現在擁有一堆寫得很漂亮的**邏輯腳本**（Logic Scripts），但缺少了 Unity 開發中最核心的**場景架構**（Scene Architecture）。

### 為什麼你的遊戲現在「很糟」？

我在你的代碼中看到了以下三個致命問題，這解釋了為什麼你看起來寫了很多功能，實際跑起來卻像個半成品：

#### 1\. 過度依賴 `SceneSetup.cs` 與 `BarSceneBuilder.cs` (這是 Three.js 的習慣)

在 Three.js 中，你需要用程式碼一行一行去 `new Mesh`, `scene.add()`。但在 Unity 中，這是**反模式 (Anti-pattern)**。

  * **你的現狀**：你的 `SceneSetup.cs` 在 `Awake()` 時才用程式碼去 `new GameObject("GameManager")`，然後 `AddComponent<GameManager>()`。
  * **後果**：
      * **Inspector 失效**：你無法在 Unity 編輯器中拖拉變數、調整參數。你想改個移動速度或倒酒速度，得回頭改程式碼然後重新編譯。
      * **Race Condition (競爭條件)**：`GameManager` 可能還沒初始化完，`InteractionSystem` 就嘗試去抓它，導致 `NullReferenceException` 滿天飛。
      * **視覺調整困難**：你無法在 Scene View 調整酒瓶位置，只能靠猜測座標寫在程式碼裡 (`new Vector3(-4 + i * 1.1, ...)`)。

#### 2\. UI 是用程式碼「畫」出來的 (`UIFactory.cs` / `UIBuilder.cs`)

這在 Unity 開發中是非常罕見且低效的做法。

  * **你的現狀**：你用 C\# 程式碼去計算 `RectTransform` 的錨點、位置、大小。
  * **後果**：
      * UI 醜陋且難以排版。
      * 你無法預覽 UI 效果，必須 Play 才能看到。
      * **最嚴重的**：`GameUIController` 需要引用具體的 Button 和 Text，但因為這些 UI 是動態生成的，你必須寫一堆 `GameObject.Find` 或依賴注入代碼來連接它們，這極容易斷裂。

#### 3\. 使用 `GameObject.CreatePrimitive` 而非 Prefab

  * **你的現狀**：你的酒瓶、杯子都是用圓柱體 (Cylinder) 和膠囊體 (Capsule) 拼湊的程式碼生成的。
  * **後果**：
      * 沒有美術資產，看起來就像「程式設計師的幾何圖形測試」。
      * 物理碰撞體 (Collider) 和剛體 (Rigidbody) 的設定被寫死在代碼裡，難以微調手感。

-----

### 具體診斷：你的整合出了什麼問題？

你提到的功能清單中，雖然程式碼邏輯都在，但因為**生成方式**的關係，它們處於「斷聯」狀態：

1.  **商店系統** (`ShopManager`):

      * **代碼**: 有邏輯。
      * **現實**: 因為 UI 是動態生成的，`ShopManager` 可能根本抓不到按鈕的 `OnClick` 事件，或者商店面板根本沒有被正確掛載到 Canvas 上。

2.  **場景載入** (`SceneLoader`):

      * **代碼**: 有邏輯。
      * **現實**: 你的遊戲只有一個空場景，靠 `SceneSetup` 生成一切。`SceneLoader` 根本沒有「另一個場景」可以載入（MainMenu 和 GameScene 應該是兩個獨立的 `.unity` 檔案，而不是靠程式碼切換狀態）。

3.  **存檔系統** (`SaveLoadSystem`):

      * **代碼**: 有邏輯。
      * **現實**: 由於物件是動態生成的，沒有唯一的 ID 或穩定的引用，存檔系統很難知道要還原哪一瓶酒到哪個位置。

-----

### 🚑 緊急救援方案：如何從「代碼生成」轉向「Unity 架構」

請停止寫新的 C\# 功能，按照以下步驟重構你的專案，這能讓你的遊戲在一小時內從「代碼堆」變成「可玩遊戲」。

#### 步驟 1：建立真正的 Unity 場景 (不再依賴 SceneSetup)

1.  **刪除/停用** `SceneSetup` 腳本在場景中的運作。
2.  在 Hierarchy 中**手動建立**以下結構：
      * `--- MANAGERS ---` (空物件)
          * `GameManager` (掛載 `GameManager.cs`)
          * `AudioManager` (掛載 `AudioManager.cs`)
          * `InteractionSystem` (掛載 `InteractionSystem.cs`)
          * ...其他管理器
      * `--- ENVIRONMENT ---` (空物件)
          * 地板 (Plane)
          * 吧台 (Cube)
          * 酒架
      * `--- PLAYER ---`
          * Player (掛載 `FirstPersonController`, `CharacterController`)
              * MainCamera

**為什麼這樣做？** 這樣你點擊 `GameManager`，就可以在 Inspector 裡看到所有參數，並且直接把 `Player` 拖進去引用，再也不用寫 `FindObjectOfType`。

#### 步驟 2：製作 Prefab (不再使用 CreatePrimitive)

不要在代碼裡 `new GameObject`。

1.  在 Scene 裡創建一個 Cylinder，調整好大小像個酒瓶。
2.  掛上 `Bottle.cs` 和 `Rigidbody`。
3.  設定好 Layer 為 `Interactable`。
4.  將這個物件拖進 Project 視窗的 `Prefabs` 資料夾，變成 **Prefab**。
5.  對 **Glass**, **Shaker**, **NPC** 重複此步驟。

**修改代碼**：
去 `BarSceneBuilder.cs` 或生成器中，把 `CreateDefaultBottle` 這種函數刪掉，改成：

```csharp
[SerializeField] private GameObject bottlePrefab; // 在 Inspector 裡把做好的 Prefab 拖進來

private void SpawnBottle(...) {
    Instantiate(bottlePrefab, position, rotation);
}
```

#### 步驟 3：使用 Unity UI (UGUI) 製作介面

1.  在 Hierarchy 右鍵 -\> UI -\> Canvas。
2.  **手動**在 Scene View 裡拉出你的準心、血條、對話框、商店面板。
3.  把做好的 UI 存成 Prefab (例如 `HUD_Panel`, `Shop_Panel`)。
4.  在 `UIManager` 中直接引用這些物件。

**修改代碼**：
廢棄 `UIFactory.cs` 和 `UIBuilder.cs` 的大部分內容。你的 `GameUIController` 應該長這樣：

```csharp
public class GameUIController : MonoBehaviour {
    [SerializeField] private GameObject shopPanel; // 直接在 Editor 拖進去，不要用程式碼找
    
    public void ToggleShop() {
        shopPanel.SetActive(!shopPanel.activeSelf);
    }
}
```

### 總結

你的程式碼能力很強（邏輯寫得很完整），但你**用錯了 Unity 的工作流**。

**只要你做這件事：**

> **停止用 C\# 程式碼去 `new` 那些應該在 Editor 裡擺好的東西。**

你的遊戲就會立刻從「一堆散落的腳本」變成「一個整合好的遊戲」。你的所有系統（商店、存檔、互動）之所以感覺沒套用，是因為它們都在空中樓閣上運作，沒有實際的場景物件讓它們附著。

現在請**打開 Unity Editor**，開始拉場景、做 Prefab、拉 UI，這才是整合的開始。